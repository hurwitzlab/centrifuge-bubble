#Bootstrap: docker
#From: r-base:latest

Bootstrap: yum
OSVersion: 7
MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
Include: yum

%runscript

    exec /usr/bin/Rscript /usr/local/bubble/stampede/centrifuge_bubble.r "$@"

%post

    #apt-get update
    #apt-get install -y git
    yum update -y
    yum install git epel-release -y
    yum install R -y
    mkdir /home1
    mkdir /work
    mkdir /scratch
    git clone https://github.com/hurwitzlab/stampede-centrifuge-bubble.git /usr/local/bubble
    cat << EOF > .Rprofile
local({
  r = getOption("repos")
  r["CRAN"] = "http://mirrors.nics.utk.edu/cran/"
  options(repos = r)
})
EOF
    /usr/bin/Rscript /usr/local/bubble/stampede/install.R
